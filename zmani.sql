--Here we update No_Problem_Flag_For_all_Fields_Agg=1, because there was no K problem with the original points_id


INSERT INTO 
  [BRIUTNT\amir.shaked].tbl_Brook_GIS_Deid_Final (
case_no,
age,
tarif,
gender,
location,
hospital,
urgent,
ownership,
Points_Id,
update_cycle,
No_Problem_Flag_For_all_Fields_Agg,
Latitude,
Longitude,
AVG_PPHH,
Cluster_10,
Madad_Points,
Cluster_20,
West_Immigrants_Rate,
Russian_Rate,
Arab_Rate,
Orthodox_Rate_cbs,
Orthodox_Rate_points,
Kipa_Rate,
Ethiopian_Rate,
MEDIAN_AGE,
DEPENDENCY_RATIO,
AVG_PERSONS_HH,
AVG_YEARS_SCHOOL_AGED_25_54,
P_ACADEMIC_DEGREE_AGED_25_54,
P_WORKERS_ACAD_OR_MANAGE,
P_WAGE_INCOME_EARNERS_15_UP,
P_WOMEN_25_54_NOT_WORKING,
P_WAGE_ABOVE_TWICE_AVG_WAGE,
P_SUB_MINIMUM_WAGE_EARNERS,
P_RECIP_SUP_AND_SUP_OLDAGE,
AVG_MONTHLY_INCOME_STAND_PER,
AVG_NUM_OF_CARS_AT_HH_PER_18_U,
AVG_NUM_ROOMS_PER_PERSON_IN_H,
AVG_NUM_BATHS_PER_PERSON_IN_H,
P_HH_WITH_PC_AND_INT_ACCESS,
M00_04P,
M05_09P,
M10_14P,
M15_19P,
M20_24P,
M25_29P,
M30_34P,
M35_39P,
M40_44P,
M45_49P,
M50_54P,
M55_59P,
M60_64P,
M65_69P,
M70_74P,
M75_P,
W00_04P,
W05_09P,
W10_14P,
W15_19P,
W20_24P,
W25_29P,
W30_34P,
W35_39P,
W40_44P,
W45_49P,
W50_54P,
W55_59P,
W60_64P,
W65_69P,
W70_74P,
W75_P,
Total00_04P,
Total05_09P,
Total10_14P,
Total15_19P,
Total20_24P,
Total25_29P,
Total30_34P,
Total35_39P,
Total40_44P,
Total45_49P,
Total50_54P,
Total55_59P,
Total60_64P,
Total65_69P,
Total70_74P,
Total75_P,
EZ_Type,
Ez_Type_CBS,
EZ_Source,
Pop_Data_Source,
Source_Russian_Rate,
Source_Ethiopian_Rate,
Source_Arab_Rate,
Edit_Date,
Source_Cluster10,
Area_Km_Sq,
Pop_Density_Points,
Cluster_10_mifkad95,
Cluster_20_mifkad95,
Cty_SKM,
HH_SKM,
Site_desc,
Site_latitude,
Site_longitude,
Record_Site_distance
)
SELECT
  
  src.case_no,
src.age,
src.tarif,
src.gender,
src.location,
src.hospital,
src.urgent,
src.ownership,
src.Points_Id,
src.update_cycle,
src.No_Problem_Flag_For_all_Fields_Agg,
src.Latitude,
src.Longitude,
src.AVG_PPHH,
src.Cluster_10,
src.Madad_Points,
src.Cluster_20,
src.West_Immigrants_Rate,
src.Russian_Rate,
src.Arab_Rate,
src.Orthodox_Rate_cbs,
src.Orthodox_Rate_points,
src.Kipa_Rate,
src.Ethiopian_Rate,
src.MEDIAN_AGE,
src.DEPENDENCY_RATIO,
src.AVG_PERSONS_HH,
src.AVG_YEARS_SCHOOL_AGED_25_54,
src.P_ACADEMIC_DEGREE_AGED_25_54,
src.P_WORKERS_ACAD_OR_MANAGE,
src.P_WAGE_INCOME_EARNERS_15_UP,
src.P_WOMEN_25_54_NOT_WORKING,
src.P_WAGE_ABOVE_TWICE_AVG_WAGE,
src.P_SUB_MINIMUM_WAGE_EARNERS,
src.P_RECIP_SUP_AND_SUP_OLDAGE,
src.AVG_MONTHLY_INCOME_STAND_PER,
src.AVG_NUM_OF_CARS_AT_HH_PER_18_U,
src.AVG_NUM_ROOMS_PER_PERSON_IN_H,
src.AVG_NUM_BATHS_PER_PERSON_IN_H,
src.P_HH_WITH_PC_AND_INT_ACCESS,
src.M00_04P,
src.M05_09P,
src.M10_14P,
src.M15_19P,
src.M20_24P,
src.M25_29P,
src.M30_34P,
src.M35_39P,
src.M40_44P,
src.M45_49P,
src.M50_54P,
src.M55_59P,
src.M60_64P,
src.M65_69P,
src.M70_74P,
src.M75_P,
src.W00_04P,
src.W05_09P,
src.W10_14P,
src.W15_19P,
src.W20_24P,
src.W25_29P,
src.W30_34P,
src.W35_39P,
src.W40_44P,
src.W45_49P,
src.W50_54P,
src.W55_59P,
src.W60_64P,
src.W65_69P,
src.W70_74P,
src.W75_P,
src.Total00_04P,
src.Total05_09P,
src.Total10_14P,
src.Total15_19P,
src.Total20_24P,
src.Total25_29P,
src.Total30_34P,
src.Total35_39P,
src.Total40_44P,
src.Total45_49P,
src.Total50_54P,
src.Total55_59P,
src.Total60_64P,
src.Total65_69P,
src.Total70_74P,
src.Total75_P,
src.EZ_Type,
src.Ez_Type_CBS,
src.EZ_Source,
src.Pop_Data_Source,
src.Source_Russian_Rate,
src.Source_Ethiopian_Rate,
src.Source_Arab_Rate,
src.Edit_Date,
src.Source_Cluster10,
src.Area_Km_Sq,
src.Pop_Density_Points,
src.Cluster_10_mifkad95,
src.Cluster_20_mifkad95,
src.Cty_SKM,
src.HH_SKM,
dis.target_place_desc,
dis.target_latitude,
dis.target_longitude,
dis.src_trg_distance

  
  FROM  [BRIUTNT\amir.shaked].tbl_Distances dis
  join [BRIUTNT\amir.shaked].tbl_Brook_GIS src on dis.case_no = src.case_no
  and dis.src_trg_distance <=15 --Radius in Km
  and src.No_Problem_Flag_For_all_Fields_Agg =1 --We only take the records flaged like this becuase we have "cleared" them regarding the population size
